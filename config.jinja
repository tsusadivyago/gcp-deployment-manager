{% set project = env["project"] %}
{% set deployment = env["deployment"] %}
{% set CLUSTER_NAME = deployment + '-gke-cluster' %}
{% set CommonTags = properties["CommonTags"] %}

resources:
- name: boomi-network
  type: network.py
  properties:
    name: boomi-network
    autoCreateSubnetworks: false
    subnetworks:
      - name: boomi-public-subnet
        region: us-central1
        ipCidrRange: 172.16.0.0/21
        privateIpGoogleAccess: true
        enableFlowLogs: false
      - name: boomi-private-subnet
        region: us-central1
        ipCidrRange: 172.16.8.0/21
        privateIpGoogleAccess: true
        enableFlowLogs: false

- name: boomi-allow-firewall
  type: firewall.py
  properties:
    network: boomi-network
    rules:
      - name: boomi-allow-ssh-to-bastion
        description: Allow SSH from anywhere to Bastion
        allowed:
          - IPProtocol: tcp
            ports:
              - "22"
              - "3389"
        direction: INGRESS
        sourceRanges:
          - 0.0.0.0/0
        targetTags:
          - bastion
      - name: boomi-allow-http-https
        description: Allow HTTP/HTTPS from anywhere
        allowed:
          - IPProtocol: tcp
            ports:
              - "80"
              - "443"
        direction: INGRESS
        sourceRanges:
          - 0.0.0.0/0
      - name: boomi-allow-icmp
        description: Allow ICMP from anywhere
        allowed:
          - IPProtocol: ICMP
        direction: INGRESS
        sourceRanges:
          - 0.0.0.0/0

- name: boomi-cloud-router
  type: cloud_router.py
  properties:
    name: boomi-cloud-router
    network: boomi-network
    region: us-central1
    asn: 65001
    nat-name: boomi-nat